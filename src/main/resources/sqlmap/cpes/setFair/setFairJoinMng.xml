<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="setFairJoinMng">
	<update id="updatePrivateUserJoinMng" parameterType="FairMngBean">
		UPDATE
			CPES_FAIR_ONLINE_PATCPTN
		<set>
			<if test="@org.apache.commons.lang.StringUtils@isNotBlank(jcAgreeStsCd)">JC_AGREE_STS_CD = #{jcAgreeStsCd},</if>
			JC_AGREE_USER_SEQ = #{user.userSeq},
			JC_AGREE_DT = NOW()
		</set>
		WHERE
			USER_SEQ = #{userSeq}
		AND
			FAIR_SEQ = #{fairSeq}
	</update>

	<insert id="insertInviteCompny" parameterType="FairMngBean">
		INSERT INTO CPES_FAIR_PATCPTN_COMPNY (
			FAIR_SEQ,
			COMPNY_SEQ,
			JC_AGREE_STS_CD,
			COMPNY_RESP_YN,
			INVITE_YN,
			INVITE_DT,
			REG_USER_SEQ,
			REG_DT
		) VALUES (
			#{fairSeq},
			#{compnySeq},
			#{jcAgreeStsCd},
			#{compnyRespYn},
			#{inviteYn},
			( CASE WHEN IFNULL(#{inviteYn}, 'N') = 'Y' THEN NOW() ELSE NULL END ),
			#{regUserSeq},
			NOW()
		)
	</insert>

	<update id="updateCompnyRequestMng" parameterType="FairMngBean">
		UPDATE
			CPES_FAIR_PATCPTN_COMPNY
		<set>
			<if test="@org.apache.commons.lang.StringUtils@isNotBlank(jcAgreeStsCd)">JC_AGREE_STS_CD = #{jcAgreeStsCd},</if>
			JC_AGREE_USER_SEQ = #{user.userSeq},
			JC_AGREE_DT = NOW()
		</set>
		WHERE
			COMPNY_SEQ = #{compnySeq}
		AND
			FAIR_SEQ = #{fairSeq}
	</update>

	<insert id="insertInviteInstt" parameterType="FairMngBean">
		INSERT INTO CPES_FAIR_PATCPTN_INSTT (
			FAIR_SEQ,
			INSTT_SEQ,
			JC_AGREE_STS_CD,
			INSTT_RESP_YN,
			INVITE_YN,
			INVITE_DT,
			REG_USER_SEQ,
			REG_DT
		) VALUES (
			#{fairSeq},
			#{insttSeq},
			#{jcAgreeStsCd},
			#{insttRespYn},
			#{inviteYn},
			( CASE WHEN IFNULL(#{inviteYn}, 'N') = 'Y' THEN NOW() ELSE NULL END ),
			#{regUserSeq},
			NOW()
		)
	</insert>

	<update id="updateInsttRequestMng" parameterType="FairMngBean">
		UPDATE
			CPES_FAIR_PATCPTN_INSTT
		<set>
			<if test="@org.apache.commons.lang.StringUtils@isNotBlank(jcAgreeStsCd)">JC_AGREE_STS_CD = #{jcAgreeStsCd},</if>
			JC_AGREE_USER_SEQ = #{user.userSeq},
			JC_AGREE_DT = NOW()
		</set>
		WHERE
			INSTT_SEQ = #{insttSeq}
		AND
			FAIR_SEQ = #{fairSeq}
	</update>

	<insert id="insertFairPatcptnCompny" parameterType="FairMngBean">
		INSERT INTO CPES_FAIR_PATCPTN_COMPNY (
		FAIR_SEQ
		, COMPNY_SEQ
		, REQ_DT
		, INVITE_YN
		, INVITE_DT
		, REG_USER_SEQ
		, REG_DT
		, DEL_YN
		, MOD_DT
		, MOD_USER_SEQ
		) VALUES (
		#{fairSeq}
		, #{compnySeq}
		, NOW()
		, 'Y'
		, NOW()
		, #{regUserSeq}
		, NOW()
		, 'N'
		, NOW()
		, #{modUserSeq}
		)
	</insert>

	<insert id="insertFairPatcptnInstt" parameterType="FairMngBean">
		INSERT INTO CPES_FAIR_PATCPTN_INSTT (
		FAIR_SEQ
		, INSTT_SEQ
		, REQ_DT
		, INVITE_YN
		, INVITE_DT
		, REG_USER_SEQ
		, REG_DT
		, DEL_YN
		, MOD_USER_SEQ
		, MOD_DT
		) VALUES (
		#{fairSeq}
		, #{insttSeq}
		, NOW()
		, 'Y'
		, NOW()
		, #{regUserSeq}
		, NOW()
		, 'N'
		, #{modUserSeq}
		, NOW()
		)
	</insert>

</mapper>
