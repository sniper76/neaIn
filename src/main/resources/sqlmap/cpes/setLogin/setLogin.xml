<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="setLogin">
	
	<!--  update auth number -->
	<update id="updateEmailUserAuthValue" parameterType="UserBean">
		/*login.updateEmailUserAuthValue*/
		UPDATE CPES_USER
		   SET EMAIL_USER_AUTH_VALUE = #{emailUserAuthValue}
		 WHERE USER_SEQ = #{userSeq} 
	</update>
	
	<!-- update user password -->
	<update id="updateUserPwd" parameterType="UserBean">
		/*login.updateUserPwd*/
		UPDATE CPES_USER
		   SET USER_PWD = #{userNewPwd}
		     , NEW_PWD_APPLY_YN = 'Y'
		     , PWD_CREAT_DT = NOW()
		     , PWD_FAIL_CNT = 0
		     , ACCNT_LOCK_STS_CD = 'ALS0000000001'
		 WHERE USER_SEQ = #{userSeq}
	</update>
	
	<!-- success login -->
	<update id="updateLogin" parameterType="UserBean">
		/*login.updateLogin*/
		UPDATE CPES_USER
		   SET PWD_FAIL_CNT = 0
		   	,  LAST_LOGIN_DT = now()
		   	,  LAST_LOGIN_IP = #{lastLoginIp}
		 WHERE USER_SEQ = #{userSeq}
	</update>
	
	<!-- fail login -->
	<update id="updateLoginFail" parameterType="UserBean">
		/*login.updateLogin*/
		UPDATE CPES_USER
		   SET PWD_FAIL_CNT = PWD_FAIL_CNT + 1
		 WHERE MNG_ID = #{mngId}
	</update>
	
</mapper>
