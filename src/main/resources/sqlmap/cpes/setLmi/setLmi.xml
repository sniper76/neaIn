<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="setLmi">

	<insert id="insertLmi" parameterType="ony.cpes.internal.lmi.bean.LmiYearBaseIndicBean">
		/*setLmi.insertLmi*/
		<selectKey resultType="string" keyProperty="lmiYearBaseIndicSeq" order="BEFORE">
        	SELECT FN_GET_UUID_SEQ() AS STR FROM DUAL
    	</selectKey>
		INSERT INTO CPES_LMI_YEAR_BASE_INDIC (
		LMI_YEAR_BASE_INDIC_SEQ
		, REG_USER_SEQ
		, REG_DT
		, MOD_USER_SEQ
		, MOD_DT
		, LMI_BASE_INDIC_SEQ
		, DEPTH
		, SORT
		, INDIC_ITEM_NM
		, YEAR
		, VIEW_YN
		, UPPER_LMI_YEAR_BASE_INDIC_SEQ
		, FULL_LMI_YEAR_BASE_INDIC_SEQ
		) VALUES (
		#{lmiYearBaseIndicSeq}
		, #{regUserSeq}
		, NOW()
		, #{modUserSeq}
		, NOW()
		, #{lmiBaseIndicSeq}
		, #{depth}
		, #{sort}
		, #{indicItemNm}
		, #{year}
		, 'Y'
		, #{upperLmiYearBaseIndicSeq}
		<choose>
			<when test="fullLmiYearBaseIndicSeq != null and fullLmiYearBaseIndicSeq != ''">
				, CONCAT(#{fullLmiYearBaseIndicSeq}, ',', #{lmiYearBaseIndicSeq})
			</when>
			<otherwise>
				, #{lmiYearBaseIndicSeq}
			</otherwise>
		</choose>
		)
	</insert>

	<insert id="insertLmiIndicData" parameterType="ony.cpes.internal.lmi.bean.LmiIndicDataBean">
		/*setLmi.insertLmiIndicData*/
		<selectKey resultType="string" keyProperty="lmiIndicDataSeq" order="BEFORE">
        	SELECT FN_GET_UUID_SEQ() AS STR FROM DUAL
    	</selectKey>
		INSERT INTO CPES_LMI_INDIC_DATA (
		LMI_INDIC_DATA_SEQ
		, REG_USER_SEQ
		, REG_DT
		, MOD_USER_SEQ
		, MOD_DT
		, LMI_YEAR_BASE_INDIC_SEQ
		, JC_CD
		, CONTENT
		, YEAR
		, DEPTH
		, SORT
		, INDIC_ITEM_NM
		, VIEW_YN
		, REPORT_CYCLE_CD
		) VALUES (
		#{lmiIndicDataSeq}
		, #{regUserSeq}
		, NOW()
		, #{modUserSeq}
		, NOW()
		, #{lmiYearBaseIndicSeq}
		, #{jcCd}
		, #{content}
		, #{year}
		, #{depth}
		, #{sort}
		, #{indicItemNm}
		, 'Y'
		, #{reportCycleCd}
		)
	</insert>

	<update id="updateLmiIndicData" parameterType="ony.cpes.internal.lmi.bean.LmiIndicDataBean">
		UPDATE CPES_LMI_INDIC_DATA
		SET MOD_DT = NOW()
		  , MOD_USER_SEQ = #{modUserSeq}
		<if test="lmiYearBaseIndicSeq != null and lmiYearBaseIndicSeq != ''">
			, LMI_YEAR_BASE_INDIC_SEQ = #{lmiYearBaseIndicSeq}
		</if>
		<if test="jcCd != null and jcCd != ''">
			, JC_CD = #{jcCd}
		</if>
		<if test="content != null and content != ''">
			, CONTENT = #{content}
		</if>
		<if test="year != null and year != ''">
			, YEAR = #{year}
		</if>
		<if test="depth != null and depth != ''">
			, DEPTH = #{depth}
		</if>
		<if test="sort != null and sort != ''">
			, SORT = #{sort}
		</if>
		<if test="indicItemNm != null and indicItemNm != ''">
			, INDIC_ITEM_NM = #{indicItemNm}
		</if>
		<if test="reportCycleCd != null and reportCycleCd != ''">
			, REPORT_CYCLE_CD = #{reportCycleCd}
		</if>
		WHERE LMI_INDIC_DATA_SEQ = #{lmiIndicDataSeq}
	</update>

</mapper>
