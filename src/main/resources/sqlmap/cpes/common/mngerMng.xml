<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mngerMng">
	
	<select id="selectMngerJcDetailInfo" parameterType="UserBean" resultType="UserBean">
	/** mngerMng.selectMngerJcDetailInfo **/
	
		SELECT 
			   B.JC_EN
			   , A.USER_NM_EN
			   , A.GENDER_CD
			   , A.MNG_ID
			   , A.USE_YN
		   	   , A.USER_SEQ
		   FROM CPES_USER A 
	 INNER JOIN CPES_JOB_CENTER B
	 		 ON A.JC_CD = B.JC_CD
	 	  WHERE A.USER_SEQ = #{userSeq} 
	</select>
	
	<select id="selectMenuMngList" parameterType="MenuBean" resultType="MenuBean">
	/** mngerMng.selectMenuMngList **/
		SELECT A.MENU_NM_KH
			 , A.MENU_NM_EN
			 , A.MENU_CD
			 , A.UPPER_MENU_CD
			 , (SELECT D.PROGRAM_URL FROM CPES_PROGRAM D WHERE B.PROGRAM_SEQ = D.PROGRAM_SEQ) AS MENU_URL 
			 , (
              CASE 
                  WHEN C.MENU_CD IS NULL
                  THEN 'N'
                  ELSE 'Y'
              END
          		) AS MENU_AUTH_YN
		  FROM CPES_MENU A
	LEFT OUTER JOIN (SELECT * FROM CPES_MENU_PROGRAM_MAP B WHERE B.PRI_PROGRAM_YN = 'Y') B
    		ON A.MENU_CD = B.MENU_CD
	LEFT OUTER JOIN (SELECT * FROM CPES_USER_MENU WHERE USER_SEQ = #{userSeq}) C
			ON A.MENU_CD = C.MENU_CD
		<where>
	     	<if test="@org.apache.commons.lang.StringUtils@isNotBlank(menuLvl)">
	     	A.MENU_LVL = #{menuLvl}
	     	</if>
	     	<if test="@org.apache.commons.lang.StringUtils@isNotBlank(rangeCd)">
	     	AND A.RANGE_CD = #{rangeCd}
	     	</if>
	     </where>
            ORDER BY A.MENU_SORT
	</select>
	
	<select id="selectProgramMng" parameterType="MenuProgramMapBean" resultType="MenuProgramMapBean">
	/** mngerMng.selectProgramMng **/
		SELECT A.PROGRAM_NM_KH
			 , A.PROGRAM_SEQ
			 , A.PROGRAM_URL
			 , MP.MENU_CD
			 , MP.PRI_PROGRAM_YN
			 , MP.MENU_PROGRAM_MAP_SEQ
			 , (
              CASE 
                  WHEN B.MENU_PROGRAM_MAP_SEQ IS NULL
                  THEN 'N'
                  ELSE 'Y'
              END
          		) AS PROGRAM_AUTH_YN
		  FROM CPES_PROGRAM A
	INNER JOIN CPES_MENU_PROGRAM_MAP MP
			ON A.PROGRAM_SEQ = MP.PROGRAM_SEQ
	LEFT OUTER JOIN (SELECT * FROM CPES_USER_PROGRAM WHERE USER_SEQ = #{userSeq}) B
			ON MP.MENU_PROGRAM_MAP_SEQ = B.MENU_PROGRAM_MAP_SEQ
	      ORDER BY A.PROGRAM_SEQ
	</select>
	
	<select id="selectProgramAuth" parameterType="MenuProgramMapBean" resultType="MenuProgramMapBean">
	/** mngerMng.selectProgramAuth **/
		SELECT A.PROGRAM_NM_KH
			 , A.PROGRAM_SEQ
			 , A.PROGRAM_URL
			 , MP.MENU_CD
			 , MP.PRI_PROGRAM_YN
			 , MP.MENU_PROGRAM_MAP_SEQ
			 , (
              CASE 
                  WHEN B.PROGRAM_SEQ IS NULL
                  THEN 'N'
                  ELSE 'Y'
              END
          		) AS PROGRAM_AUTH_YN
		  FROM CPES_PROGRAM A
	INNER JOIN CPES_MENU_PROGRAM_MAP MP
			ON A.PROGRAM_SEQ = MP.PROGRAM_SEQ
	INNER JOIN (SELECT * FROM CPES_USER_PROGRAM WHERE USER_SEQ = #{userSeq}) B
			ON MP.PROGRAM_SEQ = B.PROGRAM_SEQ
		 WHERE MP.PRI_PROGRAM_YN = 'Y'
	      ORDER BY A.PROGRAM_SEQ
	</select>
	
</mapper>
